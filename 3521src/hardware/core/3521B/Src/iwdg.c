/**
 * **********************************************************************************
 * @copyright Copyright (c) 2023 Shaanxi Tianji Communication Technologies Co., Ltd.
 *
 * @file        iwdg.c
 * @author      WangJun
 * @version     None
 * @date        2023-09-05
 * @brief       None
 *
 * **********************************************************************************
 */

#include "iwdg.h"


/*---------------------- 端口定义 ----------------------*/


/*---------------------- 宏 定 义 ----------------------*/


/*---------------------- 结 构 体 ----------------------*/


/*---------------------- 常    量 ----------------------*/


/*---------------------- 全局变量 ----------------------*/


/*---------------------- 局部变量 ----------------------*/


/*---------------------- 函    数 ----------------------*/
/*****************************************************************************
* @brief  : configure fwdg
* @param  : None
* @retval : None
* @date   : 2023-09-05
* @note   :
*****************************************************************************/
void fwgd_init(void)
{
    /* enable IRC32K */
    rcu_osci_on(RCU_IRC32K);

    /* wait till IRC32K is ready */
    while(SUCCESS != rcu_osci_stab_wait(RCU_IRC32K))
    {
    }

    /* confiure FWDGT counter clock: 32KHz(IRC32K) / 256 = 0.125 KHz */
    /* time = 0x0EA6 / 0.125KHz = 30s */
    // 理论计算为30s，实际为28s多
    fwdgt_config(0x0EA6, FWDGT_PSC_DIV256);

    /* enable fwdg */
    fwdgt_enable();
}


///*****************************************************************************
//* @brief  : 喂狗
//* @param  : None
//* @retval : 
//* @date   : 2023-09-05
//* @note   : 
//*****************************************************************************/
//void fwdg_feed(void)
//{
//    fwdgt_counter_reload();
//}


///*****************************************************************************
//* @brief  : 冻结fwdg
//* @param  : None
//* @retval : 
//* @date   : 2023-09-05
//* @note   : 测试有问题，不使用
//*****************************************************************************/
//void fwdg_dbg_stop(void)
//{
//    dbg_periph_enable(DBG_FWDGT_HOLD);
//}
